<%@page import="com.dogma.vo.*"%><%@page import="com.dogma.vo.filter.*"%><%@page import="java.util.*"%><%@page import="com.dogma.bean.query.MonitorProcessesBean"%><%@include file="../../../../components/scripts/server/startInc.jsp" %><HTML><head><%@include file="../../../../components/scripts/server/headInclude.jsp" %></head><body><jsp:useBean id="dBean" scope="session" class="com.dogma.bean.query.MonitorProcessesBean"></jsp:useBean><TABLE class="pageTop"><COL class="col1"><COL class="col2"><TR><TD><%=LabelManager.getName(labelSet,"titMon")%>: <%= dBean.getMonProInstanceVo().getProTitle() %> (<%= dBean.getMonProInstanceVo().getProcessIdentification() %>)</TD><TD></TD></TR></TABLE><DIV id="divContent" name="divContent" <%=cmp_div_height%> class="divContent"><form id="frmMain" name="frmMain" method="POST"><%	if (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_VISUAL) { %><DIV class="divContent"><TABLE class="tblFormLayout" WIDTH="100%" BORDER=0 cellspacing=0><TR><TD VALIGN="middle" ALIGN="center"><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0" WIDTH="100%" HEIGHT="450px" id="shell" ALIGN="center" VALIGN="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="<%=Parameters.ROOT_PATH%>/flash/proMon/deploy/shell.swf" /><param name="FlashVars" value="utf=<%="UTF-8".equals(Parameters.APP_ENCODING)%>&definition=query.MonitorProcessesAction.do?xml=true%26action=&IN_APIA=true&SWF_OBJ_PATH=<%=Parameters.ROOT_PATH%>/flash/proMon/deploy/"/><param name="quality" value="high" /><param name="menu" value="false"><param name="wmode" value="transparent" /><embed menu="false" wmode="transparent" allowScriptAccess="sameDomain" src="<%=Parameters.ROOT_PATH%>/flash/proMon/deploy/shell.swf" quality="high" bgcolor="#efefef" width="100%" height="450" swLiveConnect="true" id="shell" name="shell" align="middle" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashVars="utf=<%="UTF-8".equals(Parameters.APP_ENCODING)%>&definition=query.MonitorProcessesAction.do?xml=true%26action=&IN_APIA=true&SWF_OBJ_PATH=<%=Parameters.ROOT_PATH%>/flash/proMon/deploy/" /></object></TD></TR></TABLE></DIV><%	} else { %><DIV class="subTit"><%=LabelManager.getName(labelSet,"sbtMonTsk")%></DIV><div type="grid" id="gridList" style="HEIGHT:<%= Parameters.SCREEN_LIST_SIZE%>px"><table width="900px" cellpadding="0" cellspacing="0"><thead><tr><%
								if (dBean.getFilter().getShowTask() != MonitorProcessFilterVo.SHOW_TSK_GANTT) { %><th min_width="100px" style="min-width:100px;width:80%" title="<%=LabelManager.getToolTip(labelSet,"lblMonTskPro")%>"><%=LabelManager.getName(labelSet,"lblMonTskPro")%></th><th min_width="90px" style="min-width:90px;width:20%" title="<%=LabelManager.getToolTip(labelSet,"lblMonPoolNom")%>"><%=LabelManager.getName(labelSet,"lblMonPoolNom")%></th><th min_width="80px" style="width:80px" title="<%=LabelManager.getToolTip(labelSet,"lblMonProEleInstSta")%>"><%=LabelManager.getName(labelSet,"lblMonProEleInstSta")%></th><th min_width="105px" style="width:105px" title="<%=LabelManager.getToolTip(labelSet,"lblMonProEleInstDatRea")%>"><%=LabelManager.getName(labelSet,"lblMonProEleInstDatRea")%></th><th min_width="105px" style="width:105px" title="<%=LabelManager.getToolTip(labelSet,"lblMonProEleInstDatEnd")%>"><%=LabelManager.getName(labelSet,"lblMonProEleInstDatEnd")%></th><%
									if (dBean.getFilter().getShowTask() != MonitorProcessFilterVo.SHOW_TSK_STATE) { %><th min_width="100px" style="width:100px" title="<%=LabelManager.getToolTip(labelSet,"lblMonProEleInstHtyEve")%>"><%=LabelManager.getName(labelSet,"lblMonProEleInstHtyEve")%></th><th min_width="150px" style="width:150px" title="<%=LabelManager.getToolTip(labelSet,"lblMonProEleInstHtyDay")%>"><%=LabelManager.getName(labelSet,"lblMonProEleInstHtyDay")%></th><%
									} %><th min_width="80px" style="width:80px" title="<%=LabelManager.getToolTip(labelSet,"lblMonUsrLog")%>"><%=LabelManager.getName(labelSet,"lblMonUsrLog")%></th><%
								} %></tr></thead><tbody><%
							if (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_GANTT) { %><tr><td bgcolor="#EAEAEA"><img id="img<%= MonitorProcessesBean.GANTT_REAL_HOPED %>" src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/btn_mod.gif'><br><br><br><img id="img<%= MonitorProcessesBean.GANTT_REAL %>" src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/btn_mod.gif'></td></tr><%
							} else {
					   			Collection col = dBean.getProInstTasks();
								if (col != null) {
									Iterator it = col.iterator();
									int i = 0;
									MonitorTaskVo mPITVo;
									boolean salto = dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_GROUP;
									Integer oldProEleInstId = null;
									while (it.hasNext()) {
										mPITVo = (MonitorTaskVo) it.next(); 
										if (salto) {
											if (MonitorTaskVo.FOR_REL_A.equals(mPITVo.getMonFor()) || MonitorTaskVo.FOR_REL_B.equals(mPITVo.getMonFor()) || MonitorTaskVo.FOR_PROCESS_ASYNC.equals(mPITVo.getMonFor()) || MonitorTaskVo.FOR_PROCESS_SYNC.equals(mPITVo.getMonFor()) || ! mPITVo.getProEleInstId().equals(oldProEleInstId)) {
												if (oldProEleInstId != null) { %><tr onclick="validateTask()"><td>&nbsp </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><%
												}
												i++;
												oldProEleInstId = mPITVo.getProEleInstId();
											}
										} %><tr onclick="validateTask()" row_id="<%=dBean.fmtStr(mPITVo.getReqString())%>" row_for="<%=dBean.fmtStr(mPITVo.getMonFor())%>" id=LIST><td style="min-width:100px" <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=dBean.fmtHTML(mPITVo.getTskTitle())%></td><td style="min-width:90px" <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=dBean.fmtHTML(mPITVo.getPoolName())%></td><td <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=
												ProEleInstanceVo.ELE_STATUS_WAITING.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaWai"):
												ProEleInstanceVo.ELE_STATUS_READY.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaRea"):
												ProEleInstHistoryVo.HTY_EVENT_RELEASE.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaRea"):
												ProEleInstanceVo.ELE_STATUS_ACQUIRED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaAcq"):
												ProEleInstanceVo.ELE_STATUS_COMPLETED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaCom"):
												ProEleInstanceVo.ELE_STATUS_UNDO.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaRol"):
												ProEleInstanceVo.ELE_STATUS_CANCELLED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaCan"):
												ProInstanceVo.PROC_STATUS_CANCELLED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaCan"):												
												ProInstanceVo.PROC_STATUS_FINALIZED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaFin"):												
												ProEleInstanceVo.ELE_STATUS_SUSPENDED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaSus"):
												ProEleInstanceVo.ELE_STATUS_ROLLBACK.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaRol"):												
												ProEleInstanceVo.ELE_STATUS_SKIPPED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaSki"):
												ProEleInstanceVo.ELE_STATUS_CONDITIONAL_SKIPPED.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaCondSki"):
													ProEleInstHistoryVo.HTY_EVENT_DEALLOCATE.equals(mPITVo.getProEleInstStatus())?LabelManager.getName(labelSet,"lblMonProEleInstStaRea"):""
											%></td><td <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=dBean.fmtHTMLAMPM(mPITVo.getProEleInstDateReady())%></td><td <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=dBean.fmtHTMLAMPM(mPITVo.getProEleInstDateEnd())%></td><%
											if (dBean.getFilter().getShowTask() != MonitorProcessFilterVo.SHOW_TSK_STATE) { %><td <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=
													ProEleInstHistoryVo.HTY_EVENT_CREATED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveCre"):
													ProEleInstHistoryVo.HTY_EVENT_WAITING.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveWai"):
													ProEleInstHistoryVo.HTY_EVENT_READY.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveRea"):
													ProEleInstHistoryVo.HTY_EVENT_ACQUIRED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveAcq"):
													ProEleInstHistoryVo.HTY_EVENT_COMPLETED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveCom"):
													ProEleInstHistoryVo.HTY_EVENT_UNDO.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveRol"):
													ProEleInstHistoryVo.HTY_EVENT_CANCELLED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveCan"):
													ProEleInstHistoryVo.HTY_EVENT_SUSPENDED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveSus"):
													ProEleInstHistoryVo.HTY_EVENT_RESUME.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveRes"):													
													ProEleInstHistoryVo.HTY_EVENT_RELEASE.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveRel"):
													ProEleInstHistoryVo.HTY_EVENT_SKIPPED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveSki"):
													ProEleInstHistoryVo.HTY_EVENT_REASIGNED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveReg"):
													ProEleInstHistoryVo.HTY_EVENT_ELEVATED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveEle"):
													ProEleInstHistoryVo.HTY_EVENT_DELEGATED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveDel"):
													ProEleInstHistoryVo.HTY_EVENT_ROLLBACK.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveRol"):
													ProEleInstHistoryVo.HTY_EVENT_CONDITIONAL_SKIPPED.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveCondSki"):
													ProEleInstHistoryVo.HTY_EVENT_DEALLOCATE.equals(mPITVo.getHtyEvent())?LabelManager.getName(labelSet,"lblMonProEleInstHtyEveDea"):""
												%></td><td <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=dBean.fmtHTMLAMPM(mPITVo.getHtyDate())%></td><%
											} %><td <%=mPITVo.isLate()?"class=\"tdProLat\"":mPITVo.isInAlert()?"class=\"tdProInAle\"":""%>><%=dBean.fmtHTML(mPITVo.getUsrLogin())%></td></tr><%
										i++;
									}
								}
							}%></tbody></table></div><%	}%><table class="navBar"><COL class="col1"><COL class="col2"><tr><td><%= LabelManager.getNameWAccess(labelSet,"lblSelShow") %>: 
				   			<select name="showTsk" accesskey="<%= LabelManager.getAccessKey(labelSet,"lblSelShow") %>" onchange="showTsk_change()"><option value="<%= MonitorProcessFilterVo.SHOW_TSK_STATE %>" <%= (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_STATE)?"selected":"" %>><%= LabelManager.getName(labelSet,"lblMonTskShoSte") %></option><option value="<%= MonitorProcessFilterVo.SHOW_TSK_HISTORY %>" <%= (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_HISTORY)?"selected":"" %>><%= LabelManager.getName(labelSet,"lblMonTskShoHis") %></option><option value="<%= MonitorProcessFilterVo.SHOW_TSK_GROUP %>" <%= (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_GROUP)?"selected":"" %>><%= LabelManager.getName(labelSet,"lblMonTskShoGrp") %></option><option value="<%= MonitorProcessFilterVo.SHOW_TSK_GANTT %>" <%= (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_GANTT)?"selected":"" %>><%= LabelManager.getName(labelSet,"lblMonTskShoGan") %></option><option value="<%= MonitorProcessFilterVo.SHOW_TSK_VISUAL %>" <%= (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_VISUAL)?"selected":"" %>><%= LabelManager.getName(labelSet,"lblMonTskShoVis") %></option></select></td><td align="right"><% if  (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_VISUAL) { %><%/*%><input type="checkbox" value="visMonDebug" name="visMonDebug" <%=dBean.isVisMonDebug()?"checked":""%>> debug&nbsp;&nbsp;<%*/%><input style="visibility:hidden" type="checkbox" value="visMonDebug" name="visMonDebug"><%if (dBean.isVisMonOrder()) {%><input type="hidden" value="visMonOrder" name="visMonOrder"><button type="button" onclick="btnVis_click('visMonShuffle=true')" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnReOrd")%>" title="<%=LabelManager.getToolTip(labelSet,"btnReOrd")%>"><%=LabelManager.getNameWAccess(labelSet,"btnReOrd")%></button><%} else {%><button type="button" onclick="btnVis_click('visMonOrder=true')" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnExport")%>" title="<%=LabelManager.getToolTip(labelSet,"btnExport")%>"><%=LabelManager.getNameWAccess(labelSet,"btnOrd")%></button><%}%><% } else { %><button type="button" onclick="btnTskExport_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnExport")%>" title="<%=LabelManager.getToolTip(labelSet,"btnExport")%>"><%=LabelManager.getNameWAccess(labelSet,"btnExport")%></button><% if (dBean.getFilter().getShowTask() != MonitorProcessFilterVo.SHOW_TSK_GANTT) { %><button type="button" onclick="btnDetTsk_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnMonDet")%>" title="<%=LabelManager.getToolTip(labelSet,"btnMonDet")%>"><%=LabelManager.getNameWAccess(labelSet,"btnMonDet")%></button><button type="button" onclick="btnTskSub_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnMonTsk")%>" title="<%=LabelManager.getToolTip(labelSet,"btnMonTsk")%>" id="btnTskSub" disabled><%=LabelManager.getNameWAccess(labelSet,"btnMonTsk")%></button><% } }%></td></tr></table><IFRAME name="idResult" id="idResult" height="0" width="0" frameborder="0"></IFRAME></form></div><TABLE class="pageBottom"><COL class="col1"><COL class="col2"><TR><TD></TD><TD><% if (dBean.getProcesses() != null && dBean.getProcesses().size() > 0) { %><button type="button" onclick="btnAnt_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnAnt")%>" title="<%=LabelManager.getToolTip(labelSet,"btnAnt")%>"><%=LabelManager.getNameWAccess(labelSet,"btnAnt")%></button><% } %><button type="button" onclick="btnBack_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnVol")%>" title="<%=LabelManager.getToolTip(labelSet,"btnVol")%>"><%=LabelManager.getNameWAccess(labelSet,"btnVol")%></button><button type="button" onclick="splash()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSal")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSal")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSal")%></button></TD></TR></TABLE></body></html><%@include file="../../../../components/scripts/server/endInc.jsp" %><script language="javascript">
function tabSwitch(){
}

var disableButton = true;
var hasParent = <%= dBean.getParent() != null %>;
var hasQueryProcessMonitor = <%= dBean.isFromQueryProcessMonitor() %>;
var hasQueryTaskMonitor = <%= dBean.isFromQueryTaskMonitor() %>;
var hastEntityMonitor = <%= dBean.isFromEntityMonitor() %>;

window.onload=function(){
<%	if (dBean.getFilter().getShowTask() == MonitorProcessFilterVo.SHOW_TSK_GANTT) { %>
	var width = screen.availWidth-200;
	document.getElementById("img<%= MonitorProcessesBean.GANTT_REAL_HOPED %>").src="<%=Parameters.ROOT_PATH%>/programs/query/monitor/process/gantt.jsp?type=<%= MonitorProcessesBean.GANTT_REAL_HOPED %>&width=" + width;
	document.getElementById("img<%= MonitorProcessesBean.GANTT_REAL %>").src="<%=Parameters.ROOT_PATH%>/programs/query/monitor/process/gantt.jsp?type=<%= MonitorProcessesBean.GANTT_REAL %>&width=" + width;
<% } %>
}

</script><script language="javascript" src='<%=Parameters.ROOT_PATH%>/programs/query/monitor/process/monitor.js'></script>