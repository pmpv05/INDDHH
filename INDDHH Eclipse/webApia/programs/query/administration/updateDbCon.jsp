<%@page import="com.dogma.vo.*"%><%@page import="com.dogma.business.*"%><%@page import="com.dogma.dao.DataBaseDAO"%><%@include file="../../../components/scripts/server/startInc.jsp" %><HTML><head><%@include file="../../../components/scripts/server/headInclude.jsp" %></head><body><jsp:useBean id="dBean" scope="session" class="com.dogma.bean.query.AdministrationBean"></jsp:useBean><%
QueryVo queryVo = dBean.getQueryVo();
String actualUser = dBean.getActualUser(request);
boolean saveChanges = (queryVo.getQryId()==null)?true:dBean.hasWritePermission(request, queryVo.getQryId(), queryVo.getPrjId(), actualUser);
boolean usePrjPerms1 = "true".equals(request.getParameter("usePrjPerms"));
%><TABLE class="pageTop"><COL class="col1"><COL class="col2"><TR><TD><%=LabelManager.getName(labelSet,"titQry")%></TD><TD></TD></TR></TABLE><div id="divContent"><form id="frmMain" name="frmMain" method="POST"><DIV class="subTit"><%=LabelManager.getName(labelSet,"sbtQryCon")%></DIV><% if (dBean.showAdvanceTab(request)) { %><div type="tabElement" id="samplesTab" ontabswitched="tabSwitch()"><div type="tab" tabTitle="<%=LabelManager.getToolTip(labelSet,"tabQryData")%>" tabText="<%=LabelManager.getName(labelSet,"tabQryData")%>"><%}%><table class="tblFormLayout"><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblNom")%>"><%=LabelManager.getNameWAccess(labelSet,"lblNom")%>:</td><td><%=dBean.fmtStr(queryVo.getQryName())%></td></tr><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblQrySource")%>"><%=LabelManager.getNameWAccess(labelSet,"lblQrySource")%></td><td colspan="3"><select name="cmbSource" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblQrySource")%>" p_required=true onChange="cmbSource_change()"><%
									if (queryVo.getSource() == null) { %><option value="" selected></option><%
									} %><option value="<%= QueryVo.SOURCE_BUS_CLASS %>" <%= QueryVo.SOURCE_BUS_CLASS.equals(queryVo.getSource())?"selected":""%>><%=LabelManager.getName(labelSet,"lblQrySrcBusCla")%></option><option value="<%= QueryVo.SOURCE_CONNECTION %>" <%= QueryVo.SOURCE_CONNECTION.equals(queryVo.getSource())?"selected":""%>><%=LabelManager.getName(labelSet,"lblQrySrcDbCon")%></option></select></td></tr><% if (dBean.getQueryVo().getSource() != null) { 
							if (QueryVo.SOURCE_BUS_CLASS.equals(queryVo.getSource())) { %><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblBusClass")%>"><%=LabelManager.getNameWAccess(labelSet,"lblBusClass")%></td><td colspan="3"><select name="cmbBusCla" onChange="selBusClass_change()" accesskey="<%=LabelManager.getToolTip(labelSet,"lblBusClass")%>" p_required=true><option value=""></option><%
											if (dBean.getBusClasses() != null) {
												Iterator iterator = dBean.getBusClasses().iterator();
												QryEvtBusClassVo eventVo = dBean.getQueryVo().getEvent(new Integer(EventVo.EVENT_QRY_EXECUTE));
												BusClassVo busClassVo = null;
												while (iterator.hasNext()) {
													busClassVo = (BusClassVo) iterator.next(); %><option value="<%= dBean.fmtInt(busClassVo.getBusClaId()) %>" <%= (eventVo != null && busClassVo.getBusClaId().equals(eventVo.getBusClaId()))?"selected":"" %> ><%= dBean.fmtStr(busClassVo.getBusClaName()) %></option><%
												}										
											} %></select></td></tr><%
							
							} else if (QueryVo.SOURCE_CONNECTION.equals(queryVo.getSource())) { %><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblQryDbNom")%>"><%=LabelManager.getNameWAccess(labelSet,"lblQryDbNom")%>:</td><td colspan="3"><select name="dbConId" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblQryDbNom")%>" p_required=true onChange="cmbSource_change()"><option value="-1" <%=(queryVo.getDbConId() == null || queryVo.getDbConId().equals(new Integer("-1")))?"selected":""%>><%=LabelManager.getName(labelSet,"lblLocalDbNom")%></option><%
					   					if (dBean.getDbConnections() != null) {
						   					Iterator iterator = dBean.getDbConnections().iterator();
						   					DbConnectionVo connection;
						   					while (iterator.hasNext()) {
						   						connection = (DbConnectionVo) iterator.next(); %><option value="<%=dBean.fmtInt(connection.getDbConId())%>" <%=connection.getDbConId().equals(queryVo.getDbConId())?"selected":""%>><%=dBean.fmtStr(connection.getDbConName())%></option><%
						   					}
						   				} %></select><button onclick="cmbSource_change()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnAct")%>" title="<%=LabelManager.getToolTip(labelSet,"btnAct")%>"><%=LabelManager.getNameWAccess(labelSet,"btnAct")%></button></td></tr><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblQryView")%>"><%=LabelManager.getNameWAccess(labelSet,"lblQryView")%>:</td><td colspan="3"><select name="viewName" onChange="selViewName_change()" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblQryViewName")%>" p_required=true><%
					   					if (queryVo.getQryViewName() == null) { %><option value=""></option><% }
					   					if (dBean.getDbViews() != null) {
						   					Iterator iterator = dBean.getDbViews().iterator();
						   					String view;
						   					while (iterator.hasNext()) {
						   						view = ((String) iterator.next()).toUpperCase(); %><option value="<%=dBean.fmtStr(view)%>" <%=(view.equals(queryVo.getQryViewName()))?"selected":""%>><% 
						   						if (DataBaseService.VIEW_GEN_BUSINESS.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_BUSINESS;
						   						} else if (DataBaseService.VIEW_GEN_ENTITY.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_ENTITY;
						   						} else if (DataBaseService.VIEW_GEN_PROCESS.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_PROCESS;
						   						} else if (DataBaseService.VIEW_GEN_TASK_LIST.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_TASK;
						   						} else if (DataBaseService.VIEW_GEN_TSK_LIST_R.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_TSK_READY;
						   						} else if (DataBaseService.VIEW_GEN_TSK_LIST_A.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_TSK_ACQ;
						   						} else if (DataBaseService.VIEW_GEN_TSK_MON.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_TSK_MON;
						   						} else if (DataBaseService.VIEW_GEN_PRO_MON.equals(view)) {
						   							view = DataBaseService.VIEW_NAME_GEN_PRO_MON;
						   						}
					   							out.println(dBean.fmtHTML(view)); %></option><%
			 			   					}
			 			   				} %></select><%
					   					if (queryVo.getQryViewName() != null) { %><button onclick="selViewName_change()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnAct")%>" title="<%=LabelManager.getToolTip(labelSet,"btnAct")%>"><%=LabelManager.getNameWAccess(labelSet,"btnAct")%></button><%
										} %></td></tr><%
							}
							if (QueryVo.SOURCE_BUS_CLASS.equals(queryVo.getSource()) || queryVo.getQryViewName() != null) { %><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblQryType")%>"><%=LabelManager.getNameWAccess(labelSet,"lblQryType")%>:</td><td colspan="3"><select name="selQryTyp" accesskey="<%= LabelManager.getAccessKey(labelSet,"lblQryType") %>" p_required=true><option value="<%=QueryVo.TYPE_QUERY%>" <%= (QueryVo.TYPE_QUERY.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypQry")%></option><option value="<%=QueryVo.TYPE_MODAL%>" <%= (QueryVo.TYPE_MODAL.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypMod")%></option><option value="<%=QueryVo.TYPE_OFF_LINE%>" <%= (QueryVo.TYPE_OFF_LINE.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypOff")%></option><% if (queryVo.isFncEntity()) { %><option value="<%=QueryVo.TYPE_ENTITY%>" <%= (QueryVo.TYPE_ENTITY.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypEnt")%></option><%}%><% if (queryVo.isFncTaskList()) { %><option value="<%=QueryVo.TYPE_TASK_LIST%>" <%= (QueryVo.TYPE_TASK_LIST.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypTas")%></option><%}%><% if (queryVo.isFncProMon()) { %><option value="<%=QueryVo.TYPE_PROCESS_MONITOR%>" <%= (QueryVo.TYPE_PROCESS_MONITOR.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypProMon")%></option><%}%><% if (queryVo.isFncTskMon()) { %><option value="<%=QueryVo.TYPE_TASK_MONITOR%>" <%= (QueryVo.TYPE_TASK_MONITOR.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypTskMon")%></option><%}%><% if (queryVo.isFncProCan()) { %><option value="<%=QueryVo.TYPE_PRO_CANCEL%>" <%= (QueryVo.TYPE_PRO_CANCEL.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypProCancel")%></option><%}%><% if (queryVo.isFncProAlt()) { %><option value="<%=QueryVo.TYPE_PRO_ALTER%>" <%= (QueryVo.TYPE_PRO_ALTER.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypProAlter")%></option><%}%><% if (queryVo.isFncMonBusEleRelated()) { %><option value="<%=QueryVo.TYPE_MON_BUS_ELE_RELATED%>" <%= (QueryVo.TYPE_MON_BUS_ELE_RELATED.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypMonBusEleRel")%></option><%}%><% if (queryVo.isFncMonBusEleProperties()) { %><option value="<%=QueryVo.TYPE_MON_BUS_ELE_PROPERTIES%>" <%= (QueryVo.TYPE_MON_BUS_ELE_PROPERTIES.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusElePrp")%></option><%}%><% if (queryVo.isFncMonBusEleDepProperties()) { %><option value="<%=QueryVo.TYPE_MON_BUS_ELE_DEP_PROPERTIES%>" <%= (QueryVo.TYPE_MON_BUS_ELE_DEP_PROPERTIES.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusEleDepPrp")%></option><%}%><% if (queryVo.isFncMonBusEleInstances()) { %><option value="<%=QueryVo.TYPE_MON_BUS_ELE_INSTANCES%>" <%= (QueryVo.TYPE_MON_BUS_ELE_INSTANCES.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusEleInstances")%></option><%}%><% if (queryVo.isFncMonEntity()) { %><option value="<%=QueryVo.TYPE_MON_ENTITY%>" <%= (QueryVo.TYPE_MON_ENTITY.equals(queryVo.getQryType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusEntity")%></option><%}%></select></td></tr><%
						   	}
						} %></table><% if (dBean.showAdvanceTab(request)) { %></div><div type="tab" tabTitle="<%=LabelManager.getToolTip(labelSet,"tabAdvance")%>" tabText="<%=LabelManager.getName(labelSet,"tabAdvance")%>"><table class="tblFormLayout"><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><td>&nbsp;</td><td><input type="checkbox" name="chkOraOpt" value="true" accessKey="<%=LabelManager.getAccessKey(labelSet,"lblQryOraHints")%>" <%= (queryVo.getFlagValue(QueryVo.FLAG_ORACLE_OPTIMIZATION))?"checked":"" %> ><%=LabelManager.getNameWAccess(labelSet,"lblQryOraHints")%></td><td>&nbsp;</td><td>&nbsp;</td></tr></table></div></div><% } %><input type="hidden" name="hidUsrCanWrite" value="<%=saveChanges%>"><input type="hidden" name="hidUsePrjPerms" value=""></form></div><TABLE class="pageBottom"><COL class="col1"><COL class="col2"><TR><TD></TD><TD><button type="button" onclick="btnConf_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSig")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSig")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSig")%></button><button type="button" onclick="btnBack_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnVol")%>" title="<%=LabelManager.getToolTip(labelSet,"btnVol")%>"><%=LabelManager.getNameWAccess(labelSet,"btnVol")%></button><button type="button" onclick="btnExit_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSal")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSal")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSal")%></button></TD></TR></TABLE></body></html><%@include file="../../../components/scripts/server/endInc.jsp" %><script language="javascript" src='<%=Parameters.ROOT_PATH%>/programs/query/administration/update.js'></script><script language="javascript" defer>
isQuery = true;
</script>