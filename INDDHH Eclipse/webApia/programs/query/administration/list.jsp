<%@page import="com.dogma.vo.*"%><%@page import="com.dogma.business.*"%><%@page import="com.dogma.vo.filter.*"%><%@page import="java.util.*"%><%@include file="../../../components/scripts/server/startInc.jsp" %><% boolean canOrderBy = false; %><HTML><head><%@include file="../../../components/scripts/server/headInclude.jsp" %></head><body><jsp:useBean id="dBean" scope="session" class="com.dogma.bean.query.AdministrationBean"></jsp:useBean><TABLE class="pageTop"><COL class="col1"><COL class="col2"><TR><TD><%=LabelManager.getName(labelSet,"titQry")%></TD><TD></TD></TR></TABLE><DIV id="divContent" class="divContent"><form id="frmMain" name="frmMain" method="POST"><DIV class="subTit"><table width="100%"><tr class="subTit"><td width="100%" align="left"><%=LabelManager.getName(labelSet,"sbtFil")%></td><td align="right"><button type="button" id="toggleFilter" title="<%=LabelManager.getToolTip(labelSet,"lblMonButFil")%>" class="btn" onclick="toggleFilterSection(<%=Parameters.SCREEN_LIST_SIZE - Parameters.FILTER_LIST_SIZE%>,<%=(Parameters.SCREEN_LIST_SIZE)%>)"><img src="<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/openToc.gif" width="8" height="7"></button></td></tr></table></DIV><DIV id="listFilterArea" style="display:none"><DIV style="OVERFLOW:AUTO;HEIGHT:<%= Parameters.FILTER_LIST_SIZE - 32 %>px;"><table class="tblFormLayout"><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><!-- PROYECTOS --><%Collection colProj = dBean.getProjects(request);
   						boolean hasProject = (dBean.getFilter().getPrjId() != null && dBean.getFilter().getPrjId().intValue() != 0);%><td title="<%=LabelManager.getToolTip(labelSet,"titPrj")%>"><%=LabelManager.getNameWAccess(labelSet,"titPrj")%>:</td><td><input type=hidden name="txtPrj" value=""><select name="selPrj" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblPrj")%>"><%if (colProj != null && colProj.size()>0) {
			   					Iterator itPrj = colProj.iterator();
			   					ProjectVo prjVo = null;%><option value="0"></option><%while (itPrj.hasNext()) {
		   							prjVo = (ProjectVo) itPrj.next();%><option value="<%=prjVo.getPrjId()%>"
									<%if (hasProject) {
										if (prjVo.getPrjId().equals(dBean.getFilter().getPrjId())) {
											out.print ("selected");
										}%>
										><%=prjVo.getPrjName()%></option><%} else {%>
											><%=prjVo.getPrjName()%></option><%}
			   						}%></select><%}%></select></td></td><!-- TIPO --><td title="<%=LabelManager.getToolTip(labelSet,"lblQryType")%>"><%=LabelManager.getNameWAccess(labelSet,"lblQryType")%>:</td><td><select name="cmbType" id="cmbType" accesskey="<%= LabelManager.getAccessKey(labelSet,"lblQryType") %>"><option value="" <%= (dBean.getFilter().getType() == null)?"selected":""%>></option><option value="<%=QueryVo.TYPE_MODAL%>" <%= (QueryVo.TYPE_MODAL.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypMod")%></option><option value="<%=QueryVo.TYPE_QUERY%>" <%= (QueryVo.TYPE_QUERY.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypQry")%></option><option value="<%=QueryVo.TYPE_OFF_LINE%>" <%= (QueryVo.TYPE_OFF_LINE.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypOff")%></option><option value="<%=QueryVo.TYPE_ENTITY%>" <%= (QueryVo.TYPE_ENTITY.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypEnt")%></option><option value="<%=QueryVo.TYPE_ENTITY_AUTOMATIC%>" <%= (QueryVo.TYPE_ENTITY.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypEntAuto")%></option><option value="<%=QueryVo.TYPE_TASK_LIST%>" <%= (QueryVo.TYPE_TASK_LIST.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypTas")%></option><option value="<%=QueryVo.TYPE_ENTITY_MODAL%>" <%= (QueryVo.TYPE_ENTITY_MODAL.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypEntMod")%></option><option value="<%=QueryVo.TYPE_PROCESS_MONITOR%>" <%= (QueryVo.TYPE_PROCESS_MONITOR.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypProMon")%></option><option value="<%=QueryVo.TYPE_TASK_MONITOR%>" <%= (QueryVo.TYPE_TASK_MONITOR.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypTskMon")%></option><option value="<%=QueryVo.TYPE_PRO_CANCEL%>" <%= (QueryVo.TYPE_PRO_CANCEL.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypProCancel")%></option><option value="<%=QueryVo.TYPE_PRO_ALTER%>" <%= (QueryVo.TYPE_PRO_ALTER.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypProAlter")%></option><option value="<%=QueryVo.TYPE_DEPRECATED%>" <%= (QueryVo.TYPE_DEPRECATED.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblDeprecated")%></option><option value="<%=QueryVo.TYPE_MON_BUS_ELE_RELATED%>" <%= (QueryVo.TYPE_MON_BUS_ELE_RELATED.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryTypMonBusEleRel")%></option><option value="<%=QueryVo.TYPE_MON_BUS_ELE_PROPERTIES%>" <%= (QueryVo.TYPE_MON_BUS_ELE_PROPERTIES.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusElePrp")%></option><option value="<%=QueryVo.TYPE_MON_BUS_ELE_DEP_PROPERTIES%>" <%= (QueryVo.TYPE_MON_BUS_ELE_DEP_PROPERTIES.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusEleDepPrp")%></option><option value="<%=QueryVo.TYPE_MON_BUS_ELE_INSTANCES%>" <%= (QueryVo.TYPE_MON_BUS_ELE_INSTANCES.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusEleInstances")%></option><option value="<%=QueryVo.TYPE_MON_ENTITY%>" <%= (QueryVo.TYPE_MON_ENTITY.equals(dBean.getFilter().getType()))?"selected":""%>><%=LabelManager.getName(labelSet,"lblQryMonBusEntity")%></option></select></td></tr><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblNom")%>"><%=LabelManager.getNameWAccess(labelSet,"lblNom")%>:</td><td><input name="txtName" maxlength="50" type="text" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblNom")%>" value="<%=dBean.fmtStr(dBean.getFilter().getName())%>"></td><td title="<%=LabelManager.getToolTip(labelSet,"lblTit")%>"><%=LabelManager.getNameWAccess(labelSet,"lblTit")%>:</td><td><input name="txtTitle" maxlength="50" type="text" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblTit")%>" value="<%=dBean.fmtStr(dBean.getFilter().getTitle())%>"></td></tr><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblDes")%>"><%=LabelManager.getNameWAccess(labelSet,"lblDes")%>:</td><td><input name="txtDesc" maxlength="50" type="text" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblDes")%>" value="<%=dBean.fmtStr(dBean.getFilter().getDesc())%>"></td><td title="<%=LabelManager.getToolTip(labelSet,"lblQryViewBusCla")%>"><%=LabelManager.getNameWAccess(labelSet,"lblQryViewBusCla")%>:</td><td><input name="txtView" maxlength="50" type="text" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblQryViewBusCla")%>" value="<%=dBean.fmtStr(dBean.getFilter().getView())%>"></td></tr></table></div><table class="tblFormLayout"><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><td></td><td colspan=3 align="right"><button type="button" onclick="btnSearch_click()" title="<%=LabelManager.getToolTip(labelSet,"btnBus")%>" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnBus")%>"><%=LabelManager.getNameWAccess(labelSet,"btnBus")%></button></td></tr></table></DIV><DIV class="subTit"><%=LabelManager.getName(labelSet,"sbtRes")%></DIV><div type="grid" id="gridList" style="height:<%=Parameters.SCREEN_LIST_SIZE%>px"><table width="500px" cellpadding="0" cellspacing="0"><thead><tr><th style="width:0px;display:none;" title="<%=LabelManager.getToolTip(labelSet,"lblSel")%>"></th><th style="width:24px" title="<%=LabelManager.getToolTip(labelSet,"lblPerm")%>">&nbsp;</th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_NAME; %><th style="width:180px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_NAME%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblNom")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblNom")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_TITLE; %><th style="width:120px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_TITLE%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblTit")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblTit")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_DESC; %><th style="width:100%<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_DESC%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblDes")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblDes")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_TYPE; %><th style="width:50px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_TYPE%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblQryType")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblQryType")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_VIEW; %><th style="width:120px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_VIEW%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblQryViewBusCla")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblQryViewBusCla")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_USER; %><th style="width:60px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_USER%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblLastUsrName")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblLastUsrName")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != QueryFilterVo.ORDER_DATE; %><th style="width:60px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=QueryFilterVo.ORDER_DATE%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblLastActDate")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblLastActDate")%><%=canOrderBy?"</u>":""%></th></tr></thead><tbody><%	Collection col = dBean.getList();
				   			String actualUser = dBean.getActualUser(request);
							if (col != null) {
								Iterator it = col.iterator();
								int i = 0;
								QueryVo queryVo = null;
								while (it.hasNext()) {
									queryVo = (QueryVo) it.next();
									boolean readPerm = dBean.hasReadPermission(request, queryVo.getQryId(), queryVo.getPrjId(), actualUser);
									boolean writePerm = dBean.hasWritePermission(request, queryVo.getQryId(), queryVo.getPrjId(), actualUser);
									%><tr><td style="width:0px;display:none;"><input type="hidden" id="idSel" name="chkSel<%=i%>"><input type="hidden" name="hidQryId<%=i%>" value="<%=dBean.fmtInt(queryVo.getQryId())%>"><input type="hidden" name="hidEnvId<%=i%>" value="<%=dBean.fmtInt(queryVo.getEnvId())%>"><input type="hidden" name="hidFncId<%=i%>" value="<%=dBean.fmtInt(queryVo.getFncId())%>"><input type="hidden" name="chkSel<%=i%>Del" value="<%= QueryVo.TYPE_ENTITY_MODAL.equals(queryVo.getQryType()) %>"></td><td align="center" vAlign="top" style="width:28px;align:center;"><% if (!readPerm) {%><img border=0 src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/noAccess.png' title="<%=LabelManager.getToolTip(labelSet,"msgCantRead")%>"><%}%><input type="hidden" name="hidUsrCanRead" value="<%=readPerm%>"><input type="hidden" name="hidUsrCanWrite" value="<%=writePerm%>"></td><td><%=dBean.fmtHTML(queryVo.getQryName())%></td><td><%=dBean.fmtHTML(queryVo.getQryTitle())%></td><td><%=dBean.fmtHTML(queryVo.getQryDesc())%></td><td><%
										String qryTypeLabel = "";
										if (QueryVo.TYPE_ENTITY.equals(queryVo.getQryType())) {
					   						qryTypeLabel = "lblQryTypEnt";
										} else if (QueryVo.TYPE_ENTITY_AUTOMATIC.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypModAuto";
										} else if (QueryVo.TYPE_MODAL.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypMod";
										} else if (QueryVo.TYPE_TASK_LIST.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypTas";
										} else if (QueryVo.TYPE_QUERY.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypQry";
										} else if (QueryVo.TYPE_OFF_LINE.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypOff";
										} else if (QueryVo.TYPE_ENTITY_MODAL.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypEntMod";
										} else if (QueryVo.TYPE_PROCESS_MONITOR.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypProMon";
										} else if (QueryVo.TYPE_TASK_MONITOR.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypTskMon";
										} else if (QueryVo.TYPE_PRO_CANCEL.equals(queryVo.getQryType())) {
											qryTypeLabel = "lblQryTypProCancel";
										} else if (QueryVo.TYPE_PRO_ALTER.equals(queryVo.getQryType())){
											qryTypeLabel = "lblQryTypProAlter";

										} else if (QueryVo.TYPE_MON_BUS_ELE_RELATED.equals(queryVo.getQryType())){
											qryTypeLabel = "lblQryTypMonBusEleRel";
										} else if (QueryVo.TYPE_MON_BUS_ELE_PROPERTIES.equals(queryVo.getQryType())){
											qryTypeLabel = "lblQryMonBusElePrp";
										} else if (QueryVo.TYPE_MON_BUS_ELE_DEP_PROPERTIES.equals(queryVo.getQryType())){
											qryTypeLabel = "lblQryMonBusEleDepPrp";
										} else if (QueryVo.TYPE_MON_BUS_ELE_INSTANCES.equals(queryVo.getQryType())){
											qryTypeLabel = "lblQryMonBusEleInstances";
										} else if (QueryVo.TYPE_MON_ENTITY.equals(queryVo.getQryType())){
											qryTypeLabel = "lblQryMonBusEntity";
										}
										out.print(LabelManager.getName(labelSet,qryTypeLabel)); %></td><%
										String show = "";
										if (DataBaseService.VIEW_GEN_BUSINESS.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_BUSINESS;
				   						} else if (DataBaseService.VIEW_GEN_ENTITY.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_ENTITY;
				   						} else if (DataBaseService.VIEW_GEN_PROCESS.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_PROCESS;
				   						} else if (DataBaseService.VIEW_GEN_TASK_LIST.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_TASK;
				   						} else if (DataBaseService.VIEW_GEN_TSK_LIST_R.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_TSK_READY;
				   						} else if (DataBaseService.VIEW_GEN_TSK_LIST_A.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_TSK_ACQ;
				   						} else if (DataBaseService.VIEW_GEN_TSK_MON.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_TSK_MON;
				   						} else if (DataBaseService.VIEW_GEN_PRO_MON.equals(queryVo.getQryViewName())) {
				   							show = DataBaseService.VIEW_NAME_GEN_PRO_MON;
				   						} else {
				   							show = dBean.fmtHTML(queryVo.getQryViewName());
				   						} %><td title="<%= show %>"><%= show %></td><td><%=dBean.fmtHTML(queryVo.getRegUser())%></td><td><%=dBean.fmtHTML(queryVo.getRegDate())%></td></tr><%i++;%><%}
							}%></tbody></table></div><table class="navBar"><COL class="col1"><COL class="col2"><tr><%@include file="../../includes/navButtons.jsp" %><td><button type="button" onclick="btnClo_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnClo")%>" title="<%=LabelManager.getToolTip(labelSet,"btnClo")%>"><%=LabelManager.getNameWAccess(labelSet,"btnClo")%></button><button type="button" onclick="btnNew_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnCre")%>" title="<%=LabelManager.getToolTip(labelSet,"btnCre")%>"><%=LabelManager.getNameWAccess(labelSet,"btnCre")%></button><button type="button" onclick="btnMod_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnMod")%>" title="<%=LabelManager.getToolTip(labelSet,"btnMod")%>"><%=LabelManager.getNameWAccess(labelSet,"btnMod")%></button><button type="button" onclick="btnDel_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnEli")%>" title="<%=LabelManager.getToolTip(labelSet,"btnEli")%>"><%=LabelManager.getNameWAccess(labelSet,"btnEli")%></button><button type="button" onclick="btnDep_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnDep")%>" title="<%=LabelManager.getToolTip(labelSet,"btnDep")%>"><%=LabelManager.getNameWAccess(labelSet,"btnDep")%></button></td></tr></table></FORM></DIV><TABLE class="pageBottom"><COL class="col1"><COL class="col2"><TR><TD></TD><TD><button type="button" onclick="splash()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSal")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSal")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSal")%></button></TD></TR></TABLE></body></html><%@include file="../../../components/scripts/server/endInc.jsp" %><script>
var msgCantDelQryEntModal = "<%= LabelManager.getName(labelSet,"msgCantDelQryEntModal") %>";
var MSG_QRY_ONLY_READ = "<%=LabelManager.getName(labelSet,"msgQryOnlyRead")%>";
var MSG_QRY_CANT_READ = "<%=LabelManager.getName(labelSet,"msgQryNoRead")%>";
var MSG_INSUF_PERMS   = "<%=LabelManager.getName(labelSet,"msgInsufPermissions")%>";
</script><script language="javascript" src='<%=Parameters.ROOT_PATH%>/programs/query/administration/list.js'></script>
