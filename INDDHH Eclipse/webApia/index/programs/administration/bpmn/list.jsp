<%@page import="com.dogma.vo.*"%><%@page import="com.dogma.vo.filter.*"%><%@page import="java.util.*"%><%@include file="../../../components/scripts/server/startInc.jsp" %><% boolean canOrderBy = false; %><HTML><head><%@include file="../../../components/scripts/server/headInclude.jsp" %></head><body><jsp:useBean id="dBean" scope="session" class="com.dogma.bean.administration.BPMNBean"></jsp:useBean><TABLE class="pageTop"><COL class="col1"><COL class="col2"><TR><TD><%=LabelManager.getName(labelSet,"titBPMN")%></TD><TD></TD></TR></TABLE><DIV id="divContent" class="divContent"><form id="frmMain" name="frmMain" method="POST"><DIV class="subTit"><table width="100%"><tr class="subTit"><td width="100%" align="left"><%=LabelManager.getName(labelSet,"sbtFil")%></td><td align="right"><button type="button" id="toggleFilter" title="<%=LabelManager.getToolTip(labelSet,"lblMonButFil")%>" class="btn" onclick="toggleFilterSection(<%=Parameters.SCREEN_LIST_SIZE - Parameters.FILTER_LIST_SIZE%>,<%=(Parameters.SCREEN_LIST_SIZE)%>)"><img src="<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/openToc.gif" width="8" height="7"></button></td></tr></table></DIV><DIV id="listFilterArea" style="display:none"><DIV style="OVERFLOW:AUTO;HEIGHT:<%= Parameters.FILTER_LIST_SIZE - 32 %>px;"><table class="tblFormLayout"><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><!-- PROYECTOS --><%Collection colProj = dBean.getProjects(request);
   						boolean hasProject = (dBean.getFilter().getPrjId() != null && dBean.getFilter().getPrjId().intValue() != 0);%><td title="<%=LabelManager.getToolTip(labelSet,"titPrj")%>"><%=LabelManager.getNameWAccess(labelSet,"titPrj")%>:</td><td><input type=hidden name="txtPrj" value=""><select name="selPrj" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblPrj")%>"><%if (colProj != null && colProj.size()>0) {
			   					Iterator itPrj = colProj.iterator();
			   					ProjectVo prjVo = null;%><option value="0"></option><%while (itPrj.hasNext()) {
		   							prjVo = (ProjectVo) itPrj.next();%><option value="<%=prjVo.getPrjId()%>"
									<%if (hasProject) {
										if (prjVo.getPrjId().equals(dBean.getFilter().getPrjId())) {
											out.print ("selected");
										}%><%}%>
				   					><%=prjVo.getPrjName()%></option><%} %><%}%></select></td><td title="<%=LabelManager.getToolTip(labelSet,"lblAccPro")%>"><%=LabelManager.getNameWAccess(labelSet,"lblAccPro")%>:</td><td><select name="cmbAction" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblAccPro")%>"><option value=""></option><option value="<%=ProcessVo.PROCESS_ACTION_CREATION%>"  <%=ProcessVo.PROCESS_ACTION_CREATION.equals(dBean.getFilter().getAction())?"selected":""%>><%=LabelManager.getName(labelSet,"lblAccProCre")%></option><%if (envUsesEntities) {%><option value="<%=ProcessVo.PROCESS_ACTION_ALTERATION%>" <%=ProcessVo.PROCESS_ACTION_ALTERATION.equals(dBean.getFilter().getAction())?"selected":""%>><%=LabelManager.getName(labelSet,"lblAccProAlt")%></option><%}%><option value="<%=ProcessVo.PROCESS_ACTION_CANCEL%>" <%=ProcessVo.PROCESS_ACTION_CANCEL.equals(dBean.getFilter().getAction())?"selected":""%>><%=LabelManager.getName(labelSet,"lblAccProCan")%></option></select></td></tr><tr><td title="<%=LabelManager.getToolTip(labelSet,"lblNom")%>"><%=LabelManager.getNameWAccess(labelSet,"lblNom")%>:</td><td><input name="txtName" maxlength="50" type="text" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblNom")%>" value="<%=dBean.fmtStr(dBean.getFilter().getName())%>"></td><td title="<%=LabelManager.getToolTip(labelSet,"lblDes")%>"><%=LabelManager.getNameWAccess(labelSet,"lblDes")%>:</td><td><input name="txtDesc" maxlength="50" type="text" accesskey="<%=LabelManager.getAccessKey(labelSet,"lblDes")%>" value="<%=dBean.fmtStr(dBean.getFilter().getDesc())%>"></td></tr></table></div><table class="tblFormLayout"><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><td></td><td colspan=3 align="right"><button type="button" onclick="btnSearch_click()" title="<%=LabelManager.getToolTip(labelSet,"btnBus")%>" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnBus")%>"><%=LabelManager.getNameWAccess(labelSet,"btnBus")%></button></td></tr></table></DIV><DIV class="subTit"><%=LabelManager.getName(labelSet,"sbtRes")%></DIV><div class="tableContainerNoHScroll" style="height:<%=Parameters.SCREEN_LIST_SIZE%>px;" type="grid" id="gridList" docBean=""><table width="900px" cellpadding="0" cellspacing="0"><thead class="fixedHeader"><tr><th style="width:0px;display:none;" title="<%=LabelManager.getToolTip(labelSet,"lblSel")%>" align=center>&nbsp;</th><th min_width="24px" style="width:24px" title="<%=LabelManager.getToolTip(labelSet,"lblLock")%>">&nbsp;</th><th min_width="24px" style="width:24px" title="<%=LabelManager.getToolTip(labelSet,"lblPerm")%>">&nbsp;</th><% canOrderBy = dBean.getFilter().getOrderBy() != ProcessFilterVo.ORDER_NAME; %><th min_width="120px" style="min-width:120px;width:40%<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=ProcessFilterVo.ORDER_NAME%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblNom")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblNom")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != ProcessFilterVo.ORDER_DESC; %><th min_width="100px" style="min-width:100px;width:60%<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=ProcessFilterVo.ORDER_DESC%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblDes")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblDes")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != ProcessFilterVo.ORDER_ACTION; %><th min_width="70px" style="width:70px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=ProcessFilterVo.ORDER_ACTION%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblAccPro")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblAccPro")%><%=canOrderBy?"</u>":""%></th><% if (Parameters.BI_INSTALLED){%><th min_width="25px" style="width:25px" title="<%=LabelManager.getToolTip(labelSet,"lblCube")%>"><%=LabelManager.getName(labelSet,"lblCube")%></th><%}%><% canOrderBy = dBean.getFilter().getOrderBy() != ProcessFilterVo.ORDER_USER; %><th min_width="70px" style="width:70px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=ProcessFilterVo.ORDER_USER%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblLastUsrName")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblLastUsrName")%><%=canOrderBy?"</u>":""%></th><% canOrderBy = dBean.getFilter().getOrderBy() != ProcessFilterVo.ORDER_DATE; %><th min_width="70px" style="width:70px<% if (canOrderBy) {%>;cursor:hand" onclick="orderBy('<%=ProcessFilterVo.ORDER_DATE%>')<%}%>" title="<%=LabelManager.getToolTip(labelSet,"lblLastActDate")%>"><%=canOrderBy?"<u>":""%><%=LabelManager.getName(labelSet,"lblLastActDate")%><%=canOrderBy?"</u>":""%></th></tr></thead><tbody class="scrollContent"><%	Collection col = dBean.getList();
				   			String actualUser = dBean.getActualUser(request);
							if (col != null) {
								Iterator it = col.iterator();
								int i = 0;
								ProcessVo gVO = null;
								while (it.hasNext()) {
									gVO = (ProcessVo) it.next();
									gVO.setLanguage(uData.getLangId());
									gVO.setProTranslations();
									boolean othUsrLock = (gVO.getProLockUser() != null && !gVO.getProLockUser().equals(actualUser));
									String usrLock = "";
									String lockBy = "";
									boolean readPerm = dBean.hasReadPermission(request, gVO.getProId(), gVO.getPrjId(), actualUser);
									boolean writePerm = dBean.hasWritePermission(request, gVO.getProId(), gVO.getPrjId(), actualUser);
									if (gVO.getProLockUser() != null) {
										if (othUsrLock) {
											usrLock = gVO.getProLockUser();
											lockBy = dBean.getProLockByMessage(gVO.getProLockUser(),gVO.getProLockDate());
										} else {	
											usrLock = "[true]";
										}
									}%><tr><%
										String color=" ";
										if (com.dogma.DogmaConstants.DB_TRUE_INT.equals(gVO.getProTemporary())){color=" style=\"color:gray\" ";}%><td style="width:0px;display:none;"><input type="hidden" name="chkSel<%=i%>"><input type="hidden" id="idSel" name="hidProId<%=i%>" value="<%=StringUtil.encodeString(new String[] {gVO.getProId().toString(), gVO.getProVerId().toString()})%>"><input type="hidden" name="hidPrjId<%=i%>" value="<%=gVO.getPrjId()%>"></td><td align="center" vAlign="top" style="align:center;"><span><% if (usrLock != "") {
											if (usrLock.equals("[true]")) {%><img border=0 src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/lock.gif'><%} else {%><img border=0 src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/lock2.gif' title="<%=lockBy%>"><%}
										}else{%><img border=0 src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/lock.gif' style='display:none;'><%}%></span><input type="hidden" name="hidUsrLock" value="<%=usrLock%>"><input type="hidden" name="hidProId" value="<%=gVO.getProId()%>"><input type="hidden" name="hidUsrCanRead" value="<%=readPerm%>"/><input type="hidden" name="hidUsrCanWrite" value="<%=writePerm%>"/><input type="hidden" name="isBPMN" value="<%=gVO.getIsBpmn()!=null && gVO.getIsBpmn()==1%>"/></td><td align="center" vAlign="top" style="align:center;"><span><% if (!readPerm) {%><img border=0 src='<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/noAccess.png' title="<%=LabelManager.getToolTip(labelSet,"msgCantRead")%>"><%}%></span></td><td style="min-width:120px" <%=color%>><%=dBean.fmtHTML(gVO.getProName())%></td><td style="min-width:150px" <%=color%>><%=dBean.fmtHTML(gVO.getProDesc())%></td><td<%=color%>><%  if (ProcessVo.PROCESS_ACTION_ALTERATION.equals(gVO.getProAction())) {
													out.print(LabelManager.getName(labelSet,"lblAccProAlt"));
												} else if (ProcessVo.PROCESS_ACTION_CANCEL.equals(gVO.getProAction())) {
													out.print(LabelManager.getName(labelSet,"lblAccProCan"));
												} else if (ProcessVo.PROCESS_ACTION_CREATION.equals(gVO.getProAction())) {
													out.print(LabelManager.getName(labelSet,"lblAccProCre"));
												}%></td><% if (Parameters.BI_INSTALLED){
											  if (gVO.getCubeId()!=null){
												String cubeTitle = dBean.getCubeTitle(gVO.getCubeId());
											    %><td><span style="vertical-align:bottom;"><img title="<%=cubeTitle%>" src="<%=Parameters.ROOT_PATH%>/images/cubes/green_cube.png"></span></td><%}else{ %><td><span style="vertical-align:bottom;"><img title="<%=LabelManager.getToolTip(labelSet,"titDonHavCube")%>" src="<%=Parameters.ROOT_PATH%>/images/cubes/gray_cube.png"></span></td><%} %><%} %><td<%=color%>><%=dBean.fmtHTML(gVO.getRegUser())%></td><td<%=color%>><%=dBean.fmtHTML(gVO.getRegDate())%></td></tr><%i++;%><%}
							}%></tbody></table></div><table class="navBar" width=100%><COL class="col1"><COL class="col2"><COL class="col3"><COL class="col4"><tr><%@include file="../../includes/navButtons.jsp" %><td width=100% align="right" colspan=3><button type="button" onclick="btnLockPro_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnLocProc")%>" title="<%=LabelManager.getToolTip(labelSet,"btnLocProc")%>"><%=LabelManager.getNameWAccess(labelSet,"btnLocProc")%></button><button type="button" onclick="btnImportXPDL_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnImportXPDL")%>" title="<%=LabelManager.getToolTip(labelSet,"btnImportXPDL")%>"><%=LabelManager.getNameWAccess(labelSet,"btnImportXPDL")%></button><% 
				   				//CAM_6643. boton sacado a pedido de ss 
				   				//<button type="button" onclick="btnExportXPDL_click()" accesskey=" <  % = LabelManager.getAccessKey(labelSet,"btnExportXPDL") % >" title="<%=LabelManager.getToolTip(labelSet,"btnExportXPDL") % >">< % = LabelManager.getNameWAccess(labelSet,"btnExportXPDL")% ></button>
				   				%><button type="button" onclick="btnRegenCond_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnProReGenCond")%>" title="<%=LabelManager.getToolTip(labelSet,"btnProReGenCond")%>"><%=LabelManager.getNameWAccess(labelSet,"btnProReGenCond")%></button><button type="button" onclick="btnRegCbe_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnRegCube")%>" title="<%=LabelManager.getToolTip(labelSet,"btnRegCube")%>"><%=LabelManager.getNameWAccess(labelSet,"btnRegCube")%></button><button type="button" onclick="btnClo_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnClo")%>" title="<%=LabelManager.getToolTip(labelSet,"btnClo")%>"><%=LabelManager.getNameWAccess(labelSet,"btnClo")%></button><button type="button" onclick="btnNew_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnCre")%>" title="<%=LabelManager.getToolTip(labelSet,"btnCre")%>"><%=LabelManager.getNameWAccess(labelSet,"btnCre")%></button><button type="button" onclick="btnMod_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnMod")%>" title="<%=LabelManager.getToolTip(labelSet,"btnMod")%>"><%=LabelManager.getNameWAccess(labelSet,"btnMod")%></button><button type="button" onclick="btnDeb_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnDebug")%>" title="<%=LabelManager.getToolTip(labelSet,"btnDebug")%>"><%=LabelManager.getNameWAccess(labelSet,"btnDebug")%></button><button type="button" onclick="btnDel_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnEli")%>" title="<%=LabelManager.getToolTip(labelSet,"btnEli")%>"><%=LabelManager.getNameWAccess(labelSet,"btnEli")%></button><button type="button" onclick="btnIni_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnIniEnt")%>" title="<%=LabelManager.getToolTip(labelSet,"btnIniEnt")%>"><%=LabelManager.getNameWAccess(labelSet,"btnIniEnt")%></button><button type="button" onclick="btnDep_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnDep")%>" title="<%=LabelManager.getToolTip(labelSet,"btnDep")%>"><%=LabelManager.getNameWAccess(labelSet,"btnDep")%></button><button type="button" onclick="btnVers_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnVers")%>" title="<%=LabelManager.getToolTip(labelSet,"btnVers")%>"><%=LabelManager.getNameWAccess(labelSet,"btnVers")%></button></td></tr></table></form><iframe id="iframeDownload" name="iframeDownload" style="width:1px;height:1px;position:absolute;display:none"></iframe></div><TABLE class="pageBottom"><COL class="col1"><COL class="col2"><TR><TD></TD><TD align="right"><button type="button" onclick="splash()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSal")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSal")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSal")%></button></TD></TR></TABLE></body></html><script src="<%=Parameters.ROOT_PATH%>/programs/administration/bpmn/process.js"></script><script>
var LOCK_SRC = "<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/lock.gif";
var LOCK2_SRC = "<%=Parameters.ROOT_PATH%>/styles/<%= styleDirectory %>/images/lock2.gif";
var LBL_PRO_ALR_LOCKED = "<%=LabelManager.getName(labelSet, "msgProAlrLocked")%>";
var LBL_ADM_WIS_UNLOCK = "<%=LabelManager.getName(labelSet, "msgAdmWishUnlock")%>";
var ADMIN_USER = "<%="admin".equals(dBean.getActualUser(request))%>"; 
var LBL_MST_LCK_PRO = "<%=LabelManager.getName(labelSet, "msgMustLockProcess")%>";
var LBL_PRO_LCK_CONT = "<%=LabelManager.getName(labelSet, "msgProLockedCont")%>";
var MSG_PRO_LCK_BY_OTH_USER = "<%=LabelManager.getName(labelSet,"msgProLockedByOthUser")%>";
var MSG_PRO_LOCKED_BY = "<%=LabelManager.getName(labelSet,"msgProLockBy2")%>";
var MSG_INSUF_PERMISSIONS = "<%=LabelManager.getName(labelSet,"msgInsufPermissions")%>";
var MSG_PRO_ONLY_READ = "<%=LabelManager.getName(labelSet,"msgProOnlyRead")%>";
var MSG_PRO_WILL_BE_DEL_FROM_ALL_SCE1 = "<%=LabelManager.getName(labelSet,"msgProWillBeDelFromAllSce1")%>";
var MSG_PRO_WILL_BE_DEL_FROM_ALL_SCE2 = "<%=LabelManager.getName(labelSet,"msgProWillBeDelFromAllSce2")%>";
var IS_BPMN = null;
var ACTUAL_USER = "<%=dBean.getActualUser(request)%>";
var MSG_PRO_CANT_READ = "<%=LabelManager.getName(labelSet,"msgProNoRead")%>";
var MSG_REG_CUBE = "<%=LabelManager.getName(labelSet,"msgConfRegProCube")%>";

</script><%@include file="../../../components/scripts/server/endInc.jsp" %>