<%@page import="com.dogma.vo.*"%>
<%@page import="java.util.*"%>
<%@page import="com.dogma.vo.custom.ProDefinitionVo"%>
<%@include file="/page/includes/startInc.jsp" %>
<%@page import="com.dogma.UserData"%>
<%@page import="com.dogma.controller.ThreadData"%>
<%@page import="com.st.util.labels.LabelManager"%>
<%@page import="com.dogma.Parameters"%>
<%@page import="com.dogma.EnvParameters"%>

<HTML>

	<head>		
		
		<%
		boolean onlyOne = request.getParameter("onlyOne") != null;		
		Integer envId = null;
		String styleDirectory = "default";
		
		UserData uData = ThreadData.getUserData();
		if (uData!=null) {
			styleDirectory = EnvParameters.getEnvParameter(uData.getEnvironmentId(),EnvParameters.ENV_STYLE);
			envId = uData.getEnvironmentId();
		} else {
			envId = new Integer(1);
		}		
		
		String labelSet = "";
		labelSet = uData.getStrLabelSetId();
		
		String context = uData.getContextPath();
		
		%>
			
		<style type="text/css">
			#defMsgBtn { margin-bottom: 8px; padding-bottom: 1px; height: 29px; width: 120px; color: #000; background-color: #f7f7f7; font-family: Tahoma, Verdana, Arial;	font-size: 8pt; border: 1px solid silver; border-radius: 3px;	margin-left: 0px; margin-right: 0px; }
			#defMsgBtn:active { vertical-align: top; padding: 4px 6px 3px; }
			#defMsgBtn:hover { background-color: #eeeeee; }	
			
			#grid { margin: 3px;  width: 360px; height: 150px; overflow-y: scroll;}
			#tableHead { border: 1px solid black;}				
			
		</style>
			
		<link href="<%= context %>/css/default/generalExecution.css" rel="stylesheet" type="text/css" >
	
		<script type="text/javascript" src="<%= context %>/js/modernizr.custom.js"></script>
		<script type="text/javascript" src="<%= context %>/js/mootools-core-1.4.5-full-compat.js"></script>
		<script type="text/javascript" src="<%= context %>/js/mootools-more-1.4.0.1-compat.js"></script>
		<script type="text/javascript" src="<%= context %>/js/generics.js"></script>
		<script type="text/javascript" src="<%= context %>/js/modalController.js"> </script>
		<script type="text/javascript" src="<%= context %>/scripts/xml.js"> </script>	
					
		<script	language="javascript">
			var BTN_CANCEL = "Cancelar";
			var BTN_CONFIRM  = "Confirmar";
			var MSIE = (navigator.userAgent.indexOf("MSIE") > 0);
			
			function btnSearch_click() {
				clearTable(document.getElementById("grid"));
				doXMLLoad();
				
			}
		
			function clearTable(obj) {
				var tbody = obj.getElementsByTagName("TBODY");
				var trs = tbody[0].getElementsByTagName("TR");
				
				for (var i = (trs.length - 1); i > 0; i--) {
					var tr = trs[i];
					tr.parentNode.removeChild(tr);
										
				}
			}
		
			function doXMLLoad() {
				var showGlobal = "<%= request.getParameter("showGlobal")%>";
				var showAutogenerated = "<%= request.getParameter("showAutogenerated")%>";
				var showOnlyEnv = "<%= request.getParameter("showOnlyEnv")%>";
				var envId = "<%=envId%>";
				
				var sXMLSourceUrl = "poolsXML.jsp?name=" + escape(document.getElementById("txtNom").value) + "&envAndGlobal=<%= request.getParameter("envAndGlobal")%>&exactMatch="+document.getElementById("chkExact").checked + "&desc=" + document.getElementById("txtDesc").value + "&showGlobal=" + showGlobal + "&showAutogenerated=" + showAutogenerated + "&showOnlyEnv=" + showOnlyEnv + "&envId=" + envId <% if (request.getParameter("showSameAs") != null) { %> + "&showSameAs=<%= request.getParameter("showSameAs") %>"<% } %>;
				var listener=new Object();
					
				listener.onLoad=function(xml){
					if (isXMLOk(xml)) {
						readDocXML(xml);
					}
				}
				
				xml.addListener(listener);				 	
				sXmlResult = __readInDOMDocument(sXMLSourceUrl);
			}
			
			function readDocXML(sXmlResult){
						
				var xmlRoot = getXMLRoot(sXmlResult);			 
				document.getElementById("moreData").style.display="none";
				document.getElementById("noData").style.display="none";
				
				if (xmlRoot.nodeName != "EXCEPTION") {
					if (xmlRoot.childNodes.length == 0) {
						document.getElementById("noData").style.display="block";
					} else {
						for(i=0;i<xmlRoot.childNodes.length;i++){
							if (i >= <%=Parameters.MAX_RESULT_MODAL %>) {
								document.getElementById("moreData").style.display="block";
								break;
							} else {								
								xRow = xmlRoot.childNodes[i];
								var oTr = document.createElement("TR");
								oTr.onclick = function selectRow(){										
										var divGrid = document.getElementById("grid");
										var tbody = divGrid.getElementsByTagName("TBODY")[0];
										
										var rows = tbody.getElementsByTagName("TR");
										
										for ( i = 0 ; i < rows.length ; i++){
											rows[i].style.background = "white";
											rows[i].style.color = "black"
										}										
										this.style.background = "#E6E6FF";
										document.getElementById("selectRow").value = this.rowIndex;
								}
								
								for(var a=0;a<3;a++){
									oTd = document.createElement("TD");
									oTr.appendChild(oTd);
								}
								
								oTr.style.visibility="";
								
								var oTd0 = oTr.getElementsByTagName("TD")[0]; 
								var oTd1 = oTr.getElementsByTagName("TD")[1]; 
								var oTd2 = oTr.getElementsByTagName("TD")[2];
								oTd0.innerHTML = "<input type='hidden' name='chk'>";
								oTd0.setAttribute("poolId",xRow.childNodes[0].firstChild.nodeValue);
								oTd0.setAttribute("poolName",xRow.childNodes[1].firstChild.nodeValue);
								oTd0.setAttribute("poolAll", xRow.childNodes[3].firstChild.nodeValue);
								oTd0.setAttribute("poolEnvCount",xRow.childNodes[4].firstChild.nodeValue);
								oTd0.setAttribute("poolAutoGen",xRow.childNodes[5].firstChild.nodeValue);
								
								oTd1.innerHTML = xRow.childNodes[1].firstChild.nodeValue;
								if(xRow.childNodes[2].firstChild){
									oTd2.innerHTML = xRow.childNodes[2].firstChild.nodeValue;
									oTd0.setAttribute("poolDesc",xRow.childNodes[2].firstChild.nodeValue);
								} else{
									oTd0.setAttribute("poolDesc","");
								}
								
								var divGrid = document.getElementById("grid");
								addRowDiv(divGrid, oTr);																
							}
						}
					}
					
				}else{
					alert("error occurred");
				}
				
				xmlRoot = "";
				sXmlResult = "";
			}		
			
			function addRowDiv(obj,otr){
				obj.getElementsByTagName("TBODY")[0].appendChild(otr);
			}			
			
			function getModalReturnValue() {
				var rowSelect = parseInt(document.getElementById("selectRow").value) - 1;
				var divGrid = document.getElementById("grid");
				var tbody = divGrid.getElementsByTagName("TBODY")[0];
				var rows = tbody.getElementsByTagName("TR");
				var resRow = rows[rowSelect];
				var oTd = resRow.getElementsByTagName("TD")[0];
				arr = new Array();
				arr[0] = oTd.getAttribute("poolId");
				arr[1] = oTd.getAttribute("poolName");
				arr[2] = oTd.getAttribute("poolAll");
				arr[3] = oTd.getAttribute("poolEnvCount");
				arr[4] = oTd.getAttribute("poolDesc");
				arr[5] = oTd.getAttribute("poolAutoGen");
				return arr;
			}
						
			function enableConfirm() {
				var rowSelect = (document.getElementById("selectRow").value > 1);
				document.getElementById("BTN_CONFIRM").disabled = rowSelect;				
			}			
			
			/*
			function btnConf_click() {
				window.returnValue=getSelected();
				window.close();
			}	
			*/
			
			/*
			function btnExit_click() {
				window.returnValue=null;
				window.close();
			}			
			*/
			
		</script>
		
	</head>
		
	<body>
		<TABLE class="pageTop">
			<COL class="col1">
			<COL class="col2">
			<TR>
				<TD><%=LabelManager.getName(labelSet, "titGru")%></TD>
				<TD></TD>
			</TR>
		</TABLE>
		
		<DIV id="divContent" class="divContent">
			<form id="frmMain" name="frmMain" method="POST" onSubmit="return false">
				<DIV class="subTit"><%=LabelManager.getName(labelSet, "sbtFil")%></DIV>
				
				<table class="tblFormLayout">
					<COL class="col1">
					<COL class="col2">
					<COL class="col3">
					<COL class="col4">
					<tr>					
						<td title="<%=LabelManager.getToolTip(labelSet, "lblNom")%>"><%=LabelManager.getNameWAccess(labelSet, "lblNom")%>:</td>
						<td> <input name="txtNom" id="txtNom" maxlength="50" accesskey="<%=LabelManager.getAccessKey(labelSet, "lblNom")%>"></td>
						<td title="<%=LabelManager.getToolTip(labelSet, "lblExact")%>"><%=LabelManager.getNameWAccess(labelSet, "lblExact")%>:</td>
						<td><input type=checkbox name="chkExact" id="chkExact"></td>
					</tr>
					
					<tr>
						<td title="<%=LabelManager.getToolTip(labelSet, "lblDesc")%>"><%=LabelManager.getNameWAccess(labelSet, "lblDesc")%>:</td>
						<td><input name="txtDesc" id="txtDesc" maxlength="250" size="40" accesskey="<%=LabelManager.getAccessKey(labelSet, "lblDesc")%>"></td>
					</tr>
					
				</table>
				
				<DIV class="subTit"><%=LabelManager.getName(labelSet, "sbtRes")%></DIV>
				
				<textarea id="selectRow" rows="1" cols="1" style="display:none;"></textarea>
				
				<div class="tableContainerNoHScroll" style="height: 155px;" id="grid" type="grid" onselect="enableConfirm()">
					<table id="gridTable" width="330px" cellpadding="0" cellspacing="0">
					
						<thead class="fixedHeader" id="tableHead">
							<tr>
								<th class="sortable" style="width: 0px; display: none;" title="<%=LabelManager.getToolTip(labelSet, "lblSel")%>"></th>
								<th id="grName" class="sortable" title="<%=LabelManager.getToolTip(labelSet, "lblNom")%>"><%=LabelManager.getName(labelSet, "lblNom")%></th>
								<th id="grDesc"  class="sortable"  title="<%=LabelManager.getToolTip(labelSet, "lblDes")%>"><%=LabelManager.getName(labelSet, "lblDes")%></th>
							</tr>
						</thead>
						
						<tbody class="scrollContent" id="gridTbody">
							<tr style="visibility: hidden;">
								<td style="width: 0px; display: none;" height="0px">
								<input type="hidden" <%if (onlyOne) {%> style="visibility: hidden"<%} else {%> onclick="chkAllGeneric(event,'chk')" <%}%>></td>
								<td min_width="130px" style="width: 130px;" height="0px">	<div></div></td>
								<td min_width="120px" style="width: 100%" height="0px"><div></div></td>
							</tr>
						</tbody>
						
					</table>					
				</div>
			</form>
			
		</DIV>
		
		<TABLE class="pageBottom">
			<COL class="col1">
			<COL class="col2">
			<COL class="col3">
			<TR>
				<TD>
					<button type="button" id="defMsgBtn" onclick="btnSearch_click()" accesskey="<%=LabelManager.getAccessKey(labelSet, "btnBus")%>"	title="<%=LabelManager.getToolTip(labelSet, "btnBus")%>"><%=LabelManager.getNameWAccess(labelSet, "btnBus")%></button>
				</TD>
				
				<TD align="center" style="width: 100%">
					<div id="moreData" style="display: none"><%=LabelManager.getName(labelSet, "lblMoreData")%></div>
					<div id="noData" style="display: none"><%=LabelManager.getName(labelSet, "lblNoData")%></div>
				</TD>
				
				<TD align="right">
					<!-- <button type="button" disabled id="btnConf" onclick="btnConf_click()" accesskey="<%=LabelManager.getAccessKey(labelSet, "btnCon")%>" title="<%=LabelManager.getToolTip(labelSet, "btnCon")%>"><%=LabelManager.getNameWAccess(labelSet, "btnCon")%></button> -->
				</TD>
				
				<TD align="right">
					<!-- <button type="button" onclick="btnExit_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSal")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSal")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSal")%></button>-->
				</TD>
			</TR>
			
		</TABLE>
	
	</body>

</HTML>
