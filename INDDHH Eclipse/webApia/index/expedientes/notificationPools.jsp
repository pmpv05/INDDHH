<%@page import="com.dogma.vo.*"%>
<%@page import="java.util.*"%>
<%@page import="com.dogma.vo.custom.ProDefinitionVo"%>
<%@include file="../page/includes/startInc.jsp" %>
<%@page import="com.dogma.UserData"%>
<%@page import="com.dogma.controller.ThreadData"%>
<%@page import="com.st.util.labels.LabelManager"%>

<HTML> 
	<head>
		<% 
		Integer envId = null;
		String styleDirectory = "default";
		UserData uData = ThreadData.getUserData();
		if (uData!=null) {
			styleDirectory = EnvParameters.getEnvParameter(uData.getEnvironmentId(),EnvParameters.ENV_STYLE);
			envId = uData.getEnvironmentId();
		} else {
			envId = new Integer(1);
		}
		//String context = uData.getContextPath();
		
		%>
		<style type="text/css">
			#defMsgBtn { margin-bottom: 8px; padding-bottom: 1px; height: 29px; width: 120px; color: #000; background-color: #f7f7f7; font-family: Tahoma, Verdana, Arial;	font-size: 8pt; border: 1px solid silver; border-radius: 3px;	margin-left: 0px; margin-right: 0px; }
			#defMsgBtn:active { vertical-align: top; padding: 4px 6px 3px; }
			#defMsgBtn:hover { background-color: #eeeeee; }
			
			#gridPools {border: 1px solid #EFEFEF; width: 300px; height: 250px; overflow-y: scroll;}
			#frmMain {margin: 30px;  width: 300px; height: 250px;}
			
			#Tittle{ font-weight: bold; font-size: 14px; transform: translate(25%, -20%);}
			
			#gridPoolsTittle{border: 1px solid #EFEFEF; width: 275px;}
			
		</style>
		
		<link href="../css/<%=styleDirectory%>/generalExecution.css" rel="stylesheet" type="text/css" >
				
		<script type="text/javascript" src="../js/modernizr.custom.js"></script>
		<script type="text/javascript" src="../js/mootools-core-1.4.5-full-compat.js"></script>
		<script type="text/javascript" src="../js/mootools-more-1.4.0.1-compat.js"></script>
		<script type="text/javascript" src="../js/generics.js"></script>
		<script type="text/javascript" src="../js/modalController.js"> </script>
		<script type="text/javascript" src="../expedientes/js/CustomJS-EXP-ELEC.js"> </script>  

		<script>
			TYPE_NUMERIC = "<%= AttributeVo.TYPE_NUMERIC %>";
			TYPE_DATE = "<%= AttributeVo.TYPE_DATE %>";
			TYPE_STRING = "<%= AttributeVo.TYPE_STRING %>";
			ENV_ID = "<%=envId%>";
			var TAB_ID_REQUEST = "<%="&tabId=" + request.getParameter("tabId").toString() +"&tokenId="+ request.getParameter("tokenId").toString()%>"
			var FORCE_SYNC = true;
		
			var BTN_CANCEL = "Cancelar";
			var BTN_CONFIRM  = "Confirmar";
			
			var context = "/Apia";
			// var context = getUrlApp();
			
		</script> 

 		<script  language="javascript">
 		
 		  	function btnAddPool_click() {
 			    
 		  		var URL =  context + "/programs/modals/poolsDocumentum.jsp?showAutogenerated=true&showOnlyEnv=true&envId=" + ENV_ID + "&showGlobal=true" + TAB_ID_REQUEST; 
 				var rets = ModalController.openWinModal(URL,550,350, null, null, true, false, false);
 			    frameElement.fireEvent('block');
 			    
 			  	rets.addEvent('confirm', function(resultado) { 					
 					var grid = document.getElementById("gridPools");
 					var tbody = grid.getElementsByTagName("TBODY")[0];
 				
 					if(resultado != null){
 						// OTD 0
 						var oTd0 = document.createElement("TD");
						oTd0.innerHTML = "<input type='hidden' name='chkPoolSel'><input type='hidden' name='idPool'><input type='hidden' name='txtPool'>";
						oTd0.getElementsByTagName("INPUT")[1].value = resultado[0];
						oTd0.getElementsByTagName("INPUT")[2].value = resultado[1];
						oTd0.style.display = "none";
						
						// OTD 1
						var oTd1 = document.createElement("TD");
						oTd1.innerHTML = resultado[1];
						oTd1.style.align = "center";
						oTd1.style.border = "1px solid #EFEFEF";
						oTd1.style.width = "275px";
						
						// OTR (ROW)
						var oTr = document.createElement("TR");
 						oTr.onclick = function selectRow(oTr){										
							var grid = document.getElementById("gridPools");
							var tbody = grid.getElementsByTagName("TBODY")[0];
							
							var rows = tbody.getElementsByTagName("TR");
							
							for ( i = 0 ; i < rows.length ; i++){
								rows[i].style.background = "white";
								rows[i].style.color = "black"
							}										
							this.style.background = "#E6E6FF";										
							document.getElementById("selectRow").value = this.rowIndex;
						};
 						
						oTr.appendChild(oTd0);
						oTr.appendChild(oTd1);
						
						// INSERTO LA ROW CREADA
						tbody.appendChild(oTr);						
 					}
 					
 				});
 			    
 			    rets.addEvent('close', function() {
 			    	
 					console.log('Se cierra el segundo modal'); 					
 					frameElement.fireEvent('unblock');
 					
 				});
 			    
 			}

 			function btnDelPool_click() {
 				var rowSelect = parseInt(document.getElementById("selectRow").value) - 1;
				var divGrid = document.getElementById("gridPools");
				var tbody = divGrid.getElementsByTagName("TBODY")[0];
				tbody.deleteRow(rowSelect);				
 			}

 			function getModalReturnValue() {
 				var pools = getSelected();
 				if (pools.length > 255) {
 					alert("Se ingresaron demasiados grupos, por favor elimine algunos.");
 					return;
 				}
 				return pools;
 			}

 			function getSelected() {
 				var grid = document.getElementById("gridPools");
 				var tbody = grid.getElementsByTagName("TBODY")[0];
 				var oRows = tbody.getElementsByTagName("TR");
 				var result = "";
 				if (oRows != null) {
 					for (i = 0; i < oRows.length; i++) {
 						var oRow = oRows[i];
						var poolId = oRow.getElementsByTagName("TD")[0].getElementsByTagName("INPUT")[1].value;
						var poolName = oRow.getElementsByTagName("TD")[0].getElementsByTagName("INPUT")[2].value;
						
						if (result == "") {
							result = poolId + ";" + poolName;
						} else {
							
							result = result + ";" + poolId + ";" + poolName;
						}					
 					}
				}
				return result;
			} 				
 			
 			function selectRow(row){										
				var grid = document.getElementById("gridPools");
				var tbody = grid.getElementsByTagName("TBODY")[0];
				
				var rows = tbody.getElementsByTagName("TR");
				
				for ( i = 0 ; i < rows.length ; i++){
					rows[i].style.background = "white";
					rows[i].style.color = "black"
				}										
				row.style.background = "#E6E6FF";										
				document.getElementById("selectRow").value = row.rowIndex;
			}
 			
 			/*
 			function btnConfPools_click(event) {
 				var pools = getSelected();
 				if (pools.length > 255) {
 					alert("Se ingresaron demasiados grupos, por favor elimine algunos.");
 					return;
 				}
 				window.returnValue = pools;
 				window.close();
 			}	
 			 */

 			/*
 			function btnExitPools_click() {
 				window.returnValue=null;
 				window.close();
 			}
 			*/
 			
		</script>
		
	</head>
	
	<body>
		<%
		String pools = request.getParameter("pools");
		String labelSet = uData.getStrLabelSetId();
		%>
		
		<!--    USUARIOS A SER NOTIFICADOS       -->
			
			<TABLE class="pageTop">
				<COL class="col1">
				<COL class="col2">
				<TR>
					<TD id= "Tittle">Grupos</TD>
					<TD></TD>
				</TR>
			</TABLE>
			
			<DIV id="divContent" class="divContent">
				<form id="frmMain" name="frmMain" method="POST" target="frmSubmit" onSubmit="return false">	
					<IFRAME id="frmSubmit" name="frmSubmit" style="display:none"></IFRAME>
					<!--  <iframe name="iframeMessages" id="iframeMessages" src="<%=Parameters.ROOT_PATH%>/frames/feedBackWin.jsp" style="display:none"  class="feedBackFrame" frameborder="no"  ></iframe>-->
					<br>
					
					<textarea id="selectRow" rows="1" cols="1" style="display:none;"></textarea>
					
					<div type="grid" id="gridPools">
						<table id="tblPools" class="tblDataGrid">
							<thead>
								<tr>
									<th style="width:0px;display:none;" title="Seleccionar"></th>
									<th id="gridPoolsTittle" title="Grupos a notificar">Grupos a notificar</th>
								</tr>
							</thead>
							
							<tbody id="tblPoolBody">
								<%
								if (pools != null && !pools.equals("") && !pools.equals("-")){
									String [] poolArr = pools.split(";");
									for (int i=0;i<poolArr.length;i++){
										String poolId = poolArr[i];
										String poolName = poolArr[i+1];
										i++;
								%>					
								<tr onclick="selectRow(this)">
									<td style="width:0px;display:none;">
										<input type="hidden" name="chkPoolSel">
										<input type=hidden name="idPool" value="<%=poolId%>">
										<input type=hidden name="txtPool" value="<%=poolName%>">
									</td>
								<td id="gridPoolsTittle">	<%=poolName%>	</td>
								</tr>
								<%}}%>
					   		</tbody>
						</table>
					</div>  
				</form>		
			</div>	
			
			<TABLE class="pageBottom">
			   	<COL class="col1">
			   	<COL class="col2">
			   	<tr>
			   		<td>
			   			<button type="button" id="defMsgBtn" onclick="btnAddPool_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnAgr")%>" title="<%=LabelManager.getToolTip(labelSet,"btnAgr")%>"><%=LabelManager.getNameWAccess(labelSet,"btnAgr")%></button>
			   			<button type="button" id="defMsgBtn" onclick="btnDelPool_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnEli")%>" title="<%=LabelManager.getToolTip(labelSet,"btnEli")%>"><%=LabelManager.getNameWAccess(labelSet,"btnEli")%></button>
					</td>
					
					<td>
						<!-- <button type="button" onclick="btnConfPools_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnCon")%>" title="<%=LabelManager.getToolTip(labelSet,"btnCon")%>"><%=LabelManager.getNameWAccess(labelSet,"btnCon")%></button> -->
						<!-- <button type="button" onclick="btnExitPools_click()" accesskey="<%=LabelManager.getAccessKey(labelSet,"btnSal")%>" title="<%=LabelManager.getToolTip(labelSet,"btnSal")%>"><%=LabelManager.getNameWAccess(labelSet,"btnSal")%></button>  --> 
			   		</td>
			   	</tr>
		   	</TABLE>
		   	
	   	</body>
</HTML>
